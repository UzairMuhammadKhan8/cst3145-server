<!DOCTYPE html>
<html lang="en">

<head>
    <title>Lab Task</title>
    <script src="https://unpkg.com/vue"> </script>
    <script src="subjects.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

    <style>
        img {
            object-fit: cover;
        }

        div#app {
            font-weight: bold;
            font-style: italic;
            font-family: sans-serif;
            font-size: 16px;
            border: none;
            color: rgb(5, 22, 14);
        }

        div {
            border: 1px rgb(4, 167, 99) solid;
            border-radius: black;
            padding: 20px;
            margin: 20px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="app">

        <!-- shoping shopcart -->
        <header>
            <h1>{{sitename}}</h1>
            <button v-on:click="buttonshowcheckout" v-if="enableshoppingcart">shopping shopcart</button>
            <P v-else>shopping shopcart empty</P>
            <div v-for="product in shopcart" style="display:inline-block;">
                <figure>
                    <img v-bind:src="product.image" width="200" height="200">
                </figure>
                <h2 v-html="product.subject"></h2>
                <P>Location: {{product.location}}</P>
                <p>Price: {{product.price}}</p>
                <P>Product I.d: {{product.id}}</P>
                <P>Number of spaces: {{product.availableInventory}}</P>
                <button v-on:click="removefromcart(product)">removefromcart</button>
            </div>
        </header>

        <main>
            <div v-if="showproduct">




                <div v-for="product in products">

                    <figure>
                        <img v-bind:src="product.image" width="200" height="200">
                    </figure>

                    <h2 v-html="product.subject"></h2>
                    <p>ID : {{ product._id}}</p>
                    <P>Location: {{product.location}}</P>
                    <p>Price: {{product.price}}</p>
                    <P>Product I.d: {{product.id}}</P>
                    <P>Number of spaces: {{product.availableInventory}}</P>
                    <button v-on:click="decrement_inventory(product); addtocart(product); " v-if="isenable(product)">
                        Add to shopcart</button>
                    <!-- only show the button when 'canAddToCart' is true when it becomes false the button disappers -->

                    <button disabled="disabled" v-else>stock empty</button>
                </div>
            </div>

            <div v-else>
                <h2>Checkout</h2>


                <form @submit="submitForm">
                    <ul>
                   <p>
                            <strong>First Name:</strong>
                            <input id="firstName" required v-model.trim="order.name" type="text" />
                        </p>
                        <p><strong>Phone : </strong><input id="phone" required v-model.number='order.phone'
                                type="number"></p>


                    </ul>
                    <input type="submit">
                </form>



            </div>
        </main>
    </div>








    <script type="text/javascript">
        var webstore = new Vue({
            el: "#app",
            data: {
                sitename: "BOOKS BUY NOW!",
                products: [],

       
                shopcart: [],
                showproduct: true,

                order: {
                    name: " ",
                    phone: null

                },

            



            },
            methods: {
                decrement_inventory(product) {
                    product.availableInventory = product.availableInventory - 1;
                },
                isenable: function (product) {
                    if (product.availableInventory > 0) {
                        return true
                    }
                    else {
                        return false
                    }
                },







                    //just pushsing the product
                addtocart: function (product) {
                    this.shopcart.push(product);
                    
                   
                   





                    const newavailableInventory = product.availableInventory;




                

                    // fetch('https://cst--3145.herokuapp.com/collection/products/' + product._id, {
                    //     method: 'PUT',
                    //     headers: {
                    //         'Content-Type': 'application/json',
                    //     },
                    //     body: JSON.stringify({ availableInventory: newavailableInventory })
                    // }).then(function (data) {
                 
                 

                    // });


                },
                //its the products on the top.
                buttonshowcheckout() {
                    this.showproduct = this.showproduct ? false : true;
                },
                removefromcart: function (product) {
                    product.availableInventory = product.availableInventory + 1;
                    const newavail = product.availableInventory;
                    this.shopcart.pop(product)



                },





                submitForm() {



                    fetch('https://cst--3145.herokuapp.com/collection/orders', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ Name: this.order.name, Phone: this.order.phone, ProductsInOrder: this.shopcart.map(({ title }) => title) })
                    })
                        .then(function (data) {
                            console.log(data);

                        });
                    this.shopcart.forEach(element => {
                        fetch('https://cw2indi.herokuapp.com/collection/lessons/' + element._id, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ availableInventory: element.availableInventory })
                        }).then(function (data) {
                            console.log(data);
                            console.log("Im Here");

                        });
                    });

                        alert('Confirmed Order!')




                    },

            

                },

                    // when click the button it will show the checkout button
                    //computed for use i dont want any parameters .
                computed: {
                    enableshoppingcart: function () {
                        if (this.shopcart.length > 0) {
                            return true
                        }
                        else {
                            return false
                        }
                    },


                },

                created: function () {

                    fetch('https://cst--3145.herokuapp.com/collection/products').then(
                        function (response) {
                            response.json().then(
                                function (json) {
                                    webstore.products = json;
                                    console.log(webstore.products)
                                });
                        });



                }


            });

    </script>

</body>

</html>